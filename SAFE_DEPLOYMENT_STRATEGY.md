# üõ°Ô∏è –°–¢–†–ê–¢–ï–ì–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–ì–û –í–ù–ï–î–†–ï–ù–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô

## üéØ –¶–µ–ª—å: –í–Ω–µ–¥—Ä–∏—Ç—å –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –ë–ï–ó –ø–æ–ª–æ–º–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã

---

## üìã –ü–†–ò–ù–¶–ò–ü–´ –ë–ï–ó–û–ü–ê–°–ù–û–ì–û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø

### 1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ**
- –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å—Ç–∞—Ä–æ–º—É
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ
- –í—Å–µ–≥–¥–∞ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞

### 2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º
- –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- Staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ production

### 3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ**
- Feature flags –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- Canary deployments (—Å–Ω–∞—á–∞–ª–∞ –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π —á–∞—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

### 4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ—Ç–∫–∞—Ç–∞ –∑–∞ 5 –º–∏–Ω—É—Ç

---

## üèóÔ∏è –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê –î–õ–Ø –ë–ï–ó–û–ü–ê–°–ù–û–ì–û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PRODUCTION                                     ‚îÇ
‚îÇ  ‚îú‚îÄ URL: https://score.mafclub.biz             ‚îÇ
‚îÇ  ‚îú‚îÄ DB: Turso Production                       ‚îÇ
‚îÇ  ‚îú‚îÄ Branch: main                               ‚îÇ
‚îÇ  ‚îî‚îÄ Auto-deploy: ‚ùå Manual only                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üë
                    ‚îÇ (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  STAGING                                        ‚îÇ
‚îÇ  ‚îú‚îÄ URL: https://staging.mafclub.biz          ‚îÇ
‚îÇ  ‚îú‚îÄ DB: Turso Staging (–∫–æ–ø–∏—è prod)            ‚îÇ
‚îÇ  ‚îú‚îÄ Branch: staging                            ‚îÇ
‚îÇ  ‚îî‚îÄ Auto-deploy: ‚úÖ On push                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üë
                    ‚îÇ (—Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏)
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DEVELOPMENT                                    ‚îÇ
‚îÇ  ‚îú‚îÄ URL: http://localhost:3000                 ‚îÇ
‚îÇ  ‚îú‚îÄ DB: Turso Dev –∏–ª–∏ Local SQLite             ‚îÇ
‚îÇ  ‚îú‚îÄ Branch: develop / feature/*                ‚îÇ
‚îÇ  ‚îî‚îÄ Auto-deploy: ‚úÖ On save (hot reload)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –®–ê–ì 1: –ü–û–î–ì–û–¢–û–í–ö–ê –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–´ (1 –¥–µ–Ω—å)

### 1.1 –°–æ–∑–¥–∞—Ç—å Git branches

```bash
cd /root/mafclubscore

# –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Ä–∞–±–æ—Ç–∞—é—â–∏–π production)
git checkout main

# –°–æ–∑–¥–∞—Ç—å staging –≤–µ—Ç–∫—É (–∫–æ–ø–∏—è main)
git checkout -b staging
git push -u origin staging

# –°–æ–∑–¥–∞—Ç—å develop –≤–µ—Ç–∫—É
git checkout -b develop
git push -u origin develop

# –ó–∞—â–∏—Ç–∏—Ç—å main –æ—Ç –ø—Ä—è–º—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤
gh api repos/lifeexplorer230/mafclubscore/branches/main/protection \
  --method PUT \
  --field required_status_checks[strict]=true \
  --field required_pull_request_reviews[required_approving_review_count]=1
```

### 1.2 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vercel –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—Ç—å staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ Vercel
vercel --scope=your-team

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å staging preview
# –í Vercel dashboard:
# - Settings ‚Üí Git ‚Üí Branch: staging
# - Environment Variables ‚Üí Add TURSO_DATABASE_URL_STAGING
```

### 1.3 –°–æ–∑–¥–∞—Ç—å Turso staging –ë–î

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é production –ë–î –¥–ª—è staging
turso db create mafia-rating-staging

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ production
turso db shell mafia-rating --dump > backup.sql
turso db shell mafia-rating-staging < backup.sql

# –ü–æ–ª—É—á–∏—Ç—å credentials
turso db show mafia-rating-staging

# –î–æ–±–∞–≤–∏—Ç—å –≤ Vercel staging environment:
# TURSO_DATABASE_URL=libsql://mafia-rating-staging.turso.io
# TURSO_AUTH_TOKEN=...
```

---

## üß™ –®–ê–ì 2: –ù–ê–°–¢–†–û–ô–ö–ê –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø (1 –¥–µ–Ω—å)

### 2.1 –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

```bash
cd /root/mafclubscore

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
npm install --save-dev \
  @testing-library/dom \
  @testing-library/user-event \
  jest-environment-jsdom \
  supertest
```

#### –°–æ–∑–¥–∞—Ç—å `/root/mafclubscore/__tests__/integration/api-integration.test.js`

```javascript
import { describe, test, expect, beforeAll, afterAll } from '@jest/globals';
import { createClient } from '@libsql/client/web';

/**
 * –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –¢–ï–°–¢–´
 * –ü—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î
 */

let db;

beforeAll(() => {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
  db = createClient({
    url: process.env.TURSO_DATABASE_URL_TEST || 'file:test.db',
    authToken: process.env.TURSO_AUTH_TOKEN_TEST,
  });
});

afterAll(async () => {
  // –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
  if (process.env.TURSO_DATABASE_URL_TEST) {
    await db.execute('DELETE FROM game_results');
    await db.execute('DELETE FROM games');
    await db.execute('DELETE FROM game_sessions');
  }
});

describe('API Integration Tests', () => {
  test('–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ ‚Üí —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É', async () => {
    // 1. –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä–æ–≤—É—é —Å–µ—Å—Å–∏—é
    const sessionResult = await db.execute({
      sql: 'INSERT INTO game_sessions (date, total_games) VALUES (?, ?)',
      args: ['2025-01-01', 1]
    });

    const sessionId = sessionResult.lastInsertRowid;
    expect(sessionId).toBeGreaterThan(0);

    // 2. –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
    const gameResult = await db.execute({
      sql: 'INSERT INTO games (session_id, game_number, winner) VALUES (?, ?, ?)',
      args: [sessionId, 1, '–ú–∏—Ä–Ω—ã–µ']
    });

    const gameId = gameResult.lastInsertRowid;

    // 3. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤
    await db.execute({
      sql: 'INSERT INTO game_results (game_id, player_id, role, points) VALUES (?, ?, ?, ?)',
      args: [gameId, 1, '–ú–∏—Ä–Ω—ã–π', 4]
    });

    // 4. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥
    const ratingResult = await db.execute(
      'SELECT * FROM players WHERE id = 1'
    );

    expect(ratingResult.rows.length).toBeGreaterThan(0);

    // 5. –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É
    await db.execute({
      sql: 'DELETE FROM game_results WHERE game_id = ?',
      args: [gameId]
    });

    await db.execute({
      sql: 'DELETE FROM games WHERE id = ?',
      args: [gameId]
    });

    // 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É–¥–∞–ª–∏–ª–æ—Å—å
    const deletedGame = await db.execute({
      sql: 'SELECT * FROM games WHERE id = ?',
      args: [gameId]
    });

    expect(deletedGame.rows.length).toBe(0);
  });
});
```

### 2.2 –°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã —Å Playwright

```bash
npm install --save-dev @playwright/test
npx playwright install
```

#### –°–æ–∑–¥–∞—Ç—å `/root/mafclubscore/__tests__/e2e/user-flow.spec.js`

```javascript
import { test, expect } from '@playwright/test';

test.describe('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏', () => {
  test('–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–π—Ç–∏–Ω–≥–∞ ‚Üí –ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞ ‚Üí –î–µ—Ç–∞–ª–∏ –∏–≥—Ä—ã', async ({ page }) => {
    // 1. –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–π—Ç–∏–Ω–≥–∞
    await page.goto('http://localhost:3000/rating.html');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
    await expect(page.locator('h1')).toContainText('–†–µ–π—Ç–∏–Ω–≥');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞
    const table = page.locator('.rating-table');
    await expect(table).toBeVisible();

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∏–≥—Ä–æ–∫–∏
    const rows = page.locator('.rating-table tbody tr');
    const count = await rows.count();
    expect(count).toBeGreaterThan(0);

    // 2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    const firstPlayer = rows.first().locator('a');
    const playerName = await firstPlayer.textContent();
    await firstPlayer.click();

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–≥—Ä–æ–∫–∞
    await expect(page).toHaveURL(/player\.html\?id=\d+/);
    await expect(page.locator('h1')).toContainText(playerName);

    // 3. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∏–≥—Ä—É –∏–≥—Ä–æ–∫–∞
    const gameLink = page.locator('.games-table tbody tr a').first();
    await gameLink.click();

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥–µ—Ç–∞–ª–∏ –∏–≥—Ä—ã
    await expect(page).toHaveURL(/game-details\.html\?id=\d+/);
    await expect(page.locator('h1')).toContainText('–ò–≥—Ä–∞');
  });

  test('–ê–¥–º–∏–Ω: –í—Ö–æ–¥ ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ –∏–≥—Ä—ã', async ({ page }) => {
    // 1. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω
    await page.goto('http://localhost:3000/login.html');

    await page.fill('input[name="username"]', 'admin');
    await page.fill('input[name="password"]', 'test_password');
    await page.click('button[type="submit"]');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
    await expect(page).toHaveURL(/game-input\.html/);

    // 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –Ω–æ–≤–æ–π –∏–≥—Ä—ã
    // (—Ç—É—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã)

    // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
    await page.click('button#save-game');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—Ö
    await expect(page.locator('.success-message')).toBeVisible();

    // 4. –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É
    const gameId = await page.locator('select#delete-game option').last().getAttribute('value');

    await page.selectOption('select#delete-game', gameId);
    await page.click('button#confirm-delete');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ
    await expect(page.locator('.success-message')).toContainText('—É–¥–∞–ª–µ–Ω–∞');
  });
});
```

### 2.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD —Å GitHub Actions

#### –°–æ–∑–¥–∞—Ç—å `.github/workflows/test.yml`

```yaml
name: Tests

on:
  push:
    branches: [develop, staging]
  pull_request:
    branches: [main, staging]

jobs:
  unit-tests:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run unit tests
        run: npm test

      - name: Run coverage
        run: npm run test:coverage

      - name: Upload coverage
        uses: codecov/codecov-action@v3

  integration-tests:
    runs-on: ubuntu-latest
    needs: unit-tests

    env:
      TURSO_DATABASE_URL_TEST: ${{ secrets.TURSO_DATABASE_URL_TEST }}
      TURSO_AUTH_TOKEN_TEST: ${{ secrets.TURSO_AUTH_TOKEN_TEST }}

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Run integration tests
        run: npm run test:integration

  e2e-tests:
    runs-on: ubuntu-latest
    needs: integration-tests

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright
        run: npx playwright install --with-deps

      - name: Start dev server
        run: npm run dev &

      - name: Wait for server
        run: npx wait-on http://localhost:3000

      - name: Run E2E tests
        run: npx playwright test

      - name: Upload test results
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-results
          path: test-results/
```

---

## üöÄ –®–ê–ì 3: –ü–û–°–¢–ï–ü–ï–ù–ù–û–ï –í–ù–ï–î–†–ï–ù–ò–ï –° FEATURE FLAGS (2 –¥–Ω—è)

### 3.1 –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É feature flags

#### –°–æ–∑–¥–∞—Ç—å `/root/mafclubscore/shared/feature-flags.js`

```javascript
/**
 * –°–∏—Å—Ç–µ–º–∞ feature flags –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
 */

const FEATURES = {
  // –§–∞–∑–∞ 0: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
  NEW_AUTH_SYSTEM: false,           // JWT –≤–º–µ—Å—Ç–æ hardcoded
  XSS_PROTECTION: false,            // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ DOM –æ–ø–µ—Ä–∞—Ü–∏–∏
  STRICT_CORS: false,               // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π CORS
  INPUT_VALIDATION: false,          // Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è

  // –§–∞–∑–∞ 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
  SHARED_HANDLERS: false,           // –û–±—â–∏–µ API handlers
  DATABASE_SERVICE: false,          // –°–ª–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –ë–î

  // –§–∞–∑–∞ 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  QUERY_OPTIMIZATION: false,        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  REDIS_CACHE: false,               // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

  // –§–∞–∑–∞ 3: –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
  NOTIFICATIONS: false,             // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  ADVANCED_STATS: false,            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  TOURNAMENTS: false                // –¢—É—Ä–Ω–∏—Ä—ã
};

// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑ environment variables
Object.keys(FEATURES).forEach(key => {
  const envValue = process.env[`FEATURE_${key}`];
  if (envValue !== undefined) {
    FEATURES[key] = envValue === 'true';
  }
});

export function isEnabled(featureName) {
  return FEATURES[featureName] === true;
}

export function getAllFlags() {
  return { ...FEATURES };
}

// –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–¥–æ–±–∞–≤–∏—Ç—å –≤ HTML)
if (typeof window !== 'undefined') {
  window.FeatureFlags = { isEnabled, getAllFlags };
}
```

### 3.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ feature flags

#### –ü—Ä–∏–º–µ—Ä: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ auth

```javascript
// api/auth/login.js
import { isEnabled } from '../../shared/feature-flags.js';

export default async function handler(request, response) {
  if (isEnabled('NEW_AUTH_SYSTEM')) {
    // –ù–û–í–ê–Ø —Å–∏—Å—Ç–µ–º–∞ —Å JWT
    return handleNewAuth(request, response);
  } else {
    // –°–¢–ê–†–ê–Ø —Å–∏—Å—Ç–µ–º–∞ (hardcoded)
    return handleOldAuth(request, response);
  }
}

async function handleNewAuth(request, response) {
  // JWT, bcrypt, HttpOnly cookies
  // ...–Ω–æ–≤—ã–π –∫–æ–¥...
}

async function handleOldAuth(request, response) {
  // –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞
  // ...—Å—Ç–∞—Ä—ã–π –∫–æ–¥...
}
```

#### –í HTML –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å UI

```javascript
// login.html
if (FeatureFlags.isEnabled('NEW_AUTH_SYSTEM')) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—É—é —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
  showNewLoginForm();
} else {
  // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ä—É—é —Ñ–æ—Ä–º—É
  showOldLoginForm();
}
```

---

## üìä –®–ê–ì 4: –ü–†–û–¶–ï–°–° –ë–ï–ó–û–ü–ê–°–ù–û–ì–û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø

### Workflow –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```
1. –†–ê–ó–†–ê–ë–û–¢–ö–ê (develop branch)
   ‚îú‚îÄ –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥
   ‚îú‚îÄ –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
   ‚îú‚îÄ –õ–æ–∫–∞–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å: npm test
   ‚îî‚îÄ Commit & Push

2. CI/CD (GitHub Actions)
   ‚îú‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
   ‚îú‚îÄ ‚úÖ –ï—Å–ª–∏ –ø—Ä–æ—à–ª–∏ ‚Üí –∑–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å
   ‚îî‚îÄ ‚ùå –ï—Å–ª–∏ —É–ø–∞–ª–∏ ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ merge

3. CODE REVIEW
   ‚îú‚îÄ –°–æ–∑–¥–∞—Ç—å Pull Request: develop ‚Üí staging
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ (–¥—Ä—É–≥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã
   ‚îî‚îÄ Approve & Merge

4. STAGING DEPLOYMENT
   ‚îú‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π deploy –Ω–∞ staging
   ‚îú‚îÄ Feature flag = false –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   ‚îú‚îÄ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging
   ‚îî‚îÄ –í–∫–ª—é—á–∏—Ç—å feature flag –Ω–∞ staging

5. STAGING VALIDATION (2-3 –¥–Ω—è)
   ‚îú‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
   ‚îú‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
   ‚îú‚îÄ –°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
   ‚îî‚îÄ –ï—Å–ª–∏ OK ‚Üí –≥–æ—Ç–æ–≤–æ –∫ production

6. PRODUCTION DEPLOYMENT
   ‚îú‚îÄ –°–æ–∑–¥–∞—Ç—å PR: staging ‚Üí main
   ‚îú‚îÄ Final review
   ‚îú‚îÄ Merge –≤ main
   ‚îú‚îÄ –†–£–ß–ù–û–ô deploy (–Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π!)
   ‚îî‚îÄ Feature flag = false

7. CANARY RELEASE (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ‚îú‚îÄ –í–∫–ª—é—á–∏—Ç—å feature flag –¥–ª—è 10% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   ‚îú‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å 24 —á–∞—Å–∞
   ‚îú‚îÄ –ï—Å–ª–∏ OK ‚Üí 50% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   ‚îú‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å 24 —á–∞—Å–∞
   ‚îî‚îÄ –ï—Å–ª–∏ OK ‚Üí 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

8. CLEANUP (—á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é)
   ‚îú‚îÄ –£–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥
   ‚îú‚îÄ –£–±—Ä–∞—Ç—å feature flag
   ‚îî‚îÄ –£–¥–∞–ª–∏—Ç—å legacy functions
```

---

## üî• –®–ê–ì 5: –ë–´–°–¢–†–´–ô –û–¢–ö–ê–¢ (ROLLBACK PROCEDURE)

### 5.1 –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –Ω–∞ production

```bash
# –ù–ï–ú–ï–î–õ–ï–ù–ù–û:

# –í–∞—Ä–∏–∞–Ω—Ç 1: –í—ã–∫–ª—é—á–∏—Ç—å feature flag
# –í Vercel dashboard ‚Üí Environment Variables
FEATURE_NEW_AUTH_SYSTEM=false

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (Vercel –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

# –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–∫–∞—Ç–∏—Ç—å deploy
vercel rollback

# –í–∞—Ä–∏–∞–Ω—Ç 3: –û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π commit
git revert HEAD
git push origin main

# Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
```

### 5.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

#### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫

```bash
npm install @sentry/node @sentry/vercel
```

#### –°–æ–∑–¥–∞—Ç—å `/root/mafclubscore/api/middleware/sentry.js`

```javascript
import * as Sentry from '@sentry/node';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.VERCEL_ENV || 'development',
  tracesSampleRate: 1.0,
});

export function captureError(error, context = {}) {
  Sentry.captureException(error, {
    extra: context,
    tags: {
      component: context.component || 'unknown'
    }
  });
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API:
try {
  // ... –∫–æ–¥
} catch (error) {
  captureError(error, {
    component: 'rating-api',
    endpoint: '/api/rating',
    userId: request.user?.id
  });

  throw error;
}
```

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –§–ê–ó–ê 0.1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1 –¥–µ–Ω—å)

```bash
# –î–µ–Ω—å 1
‚úÖ –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫–∏: develop, staging
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vercel staging environment
‚úÖ –°–æ–∑–¥–∞—Ç—å Turso staging –ë–î
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Actions CI/CD
‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤
‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É feature flags
```

### –§–ê–ó–ê 0.2: –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã (1 –¥–µ–Ω—å)

```bash
# –î–µ–Ω—å 2
‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å integration tests
‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å E2E tests –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö flow
‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å code coverage
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ
```

### –§–ê–ó–ê 1: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - XSS –∑–∞—â–∏—Ç–∞ (3 –¥–Ω—è)

**–ü–æ—á–µ–º—É –ø–µ—Ä–≤—ã–º?** –≠—Ç–æ –ù–ï –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É, —Ç–æ–ª—å–∫–æ –º–µ–Ω—è–µ—Ç —Å–ø–æ—Å–æ–± —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.

```bash
# –î–µ–Ω—å 3-4: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É: git checkout -b feature/xss-protection
2. –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã dom-safe.js
3. –ó–∞–º–µ–Ω–∏—Ç—å innerHTML –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ rating.html
4. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è dom-safe.js
5. –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: npm test
6. Commit & Push

# –î–µ–Ω—å 5: Staging
7. –°–æ–∑–¥–∞—Ç—å PR: feature/xss-protection ‚Üí develop
8. Code review
9. Merge –≤ develop
10. –°–æ–∑–¥–∞—Ç—å PR: develop ‚Üí staging
11. Deploy –Ω–∞ staging (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
12. –í–∫–ª—é—á–∏—Ç—å FEATURE_XSS_PROTECTION=true –Ω–∞ staging
13. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
14. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 24 —á–∞—Å–∞

# –î–µ–Ω—å 6: Production (–µ—Å–ª–∏ staging OK)
15. –°–æ–∑–¥–∞—Ç—å PR: staging ‚Üí main
16. Final review
17. Merge –≤ main
18. –†–£–ß–ù–û–ô deploy –Ω–∞ production
19. FEATURE_XSS_PROTECTION=false (–ø–æ–∫–∞)
20. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
21. –í–∫–ª—é—á–∏—Ç—å FEATURE_XSS_PROTECTION=true
22. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 24 —á–∞—Å–∞
23. –ï—Å–ª–∏ OK ‚Üí —É–±—Ä–∞—Ç—å feature flag —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é
```

### –§–ê–ó–ê 2: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - CORS (1 –¥–µ–Ω—å)

```bash
# –î–µ–Ω—å 7: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + Staging
1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É: feature/strict-cors
2. –°–æ–∑–¥–∞—Ç—å cors.js middleware
3. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ API endpoints
4. –¢–µ—Å—Ç—ã: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
5. Push ‚Üí CI/CD ‚Üí Staging
6. –í–∫–ª—é—á–∏—Ç—å FEATURE_STRICT_CORS=true –Ω–∞ staging
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: –∑–∞–ø—Ä–æ—Å—ã —Å —Ä–∞–∑–Ω—ã—Ö origin

# –î–µ–Ω—å 8: Production
8. Deploy –Ω–∞ production —Å feature flag
9. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ
10. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CORS –æ—à–∏–±–æ–∫ –≤ Sentry
```

### –§–ê–ó–ê 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –í–∞–ª–∏–¥–∞—Ü–∏—è (2 –¥–Ω—è)

```bash
# –î–µ–Ω—å 9-10: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + Staging
1. –í–µ—Ç–∫–∞: feature/input-validation
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Zod
3. –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å –≤ API endpoints (—Å feature flag)
5. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
6. Staging ‚Üí —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ edge cases

# –î–µ–Ω—å 11: Production
7. Deploy —Å FEATURE_INPUT_VALIDATION=false
8. –í–∫–ª—é—á–∏—Ç—å –¥–ª—è 10% –∑–∞–ø—Ä–æ—Å–æ–≤ (canary)
9. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å validation errors
10. –ï—Å–ª–∏ OK ‚Üí 100%
```

### –§–ê–ó–ê 4: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - JWT Auth (5 –¥–Ω–µ–π)

**–°–∞–º–æ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ!** –¢—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏.

```bash
# –î–µ–Ω—å 12-14: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
1. –í–µ—Ç–∫–∞: feature/jwt-auth
2. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É users
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å /api/auth/login
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å JWT middleware
5. –û–±–Ω–æ–≤–∏—Ç—å login.html (—Å feature flag)
6. –í–ê–ñ–ù–û: –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç–∞—é—â–µ–π

# login.html –∫–æ–¥:
if (FeatureFlags.isEnabled('NEW_AUTH_SYSTEM')) {
  // –ù–æ–≤–∞—è JWT —Å–∏—Å—Ç–µ–º–∞
  handleNewAuth();
} else {
  // –°—Ç–∞—Ä–∞—è hardcoded —Å–∏—Å—Ç–µ–º–∞
  handleOldAuth();
}

# API –∫–æ–¥:
if (isEnabled('NEW_AUTH_SYSTEM')) {
  // –ü—Ä–æ–≤–µ—Ä—è—Ç—å JWT —Ç–æ–∫–µ–Ω
  verifyJWT(request);
} else {
  // –ü—Ä–æ–≤–µ—Ä—è—Ç—å Bearer egor_admin
  checkOldAuth(request);
}

# –î–µ–Ω—å 15-16: Staging
7. Staging deployment
8. FEATURE_NEW_AUTH_SYSTEM=false —Å–Ω–∞—á–∞–ª–∞
9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é —Å–∏—Å—Ç–µ–º—É - –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
10. –í–∫–ª—é—á–∏—Ç—å FEATURE_NEW_AUTH_SYSTEM=true
11. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
12. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ç—É–¥–∞-—Å—é–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
13. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç

# –î–µ–Ω—å 17-18: Production
14. Deploy –Ω–∞ production
15. FEATURE_NEW_AUTH_SYSTEM=false
16. –í–∫–ª—é—á–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
17. –ï—Å–ª–∏ OK ‚Üí –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤
18. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 48 —á–∞—Å–æ–≤
19. –ï—Å–ª–∏ OK ‚Üí —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é
```

---

## üéØ –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –ö–ê–ñ–î–´–ú PRODUCTION DEPLOY

```bash
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (unit + integration + e2e)
‚úÖ Code review –≤—ã–ø–æ–ª–Ω–µ–Ω
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ staging –º–∏–Ω–∏–º—É–º 24 —á–∞—Å–∞
‚úÖ Feature flag —Å–æ–∑–¥–∞–Ω –∏ –≤—ã–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚úÖ –°—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ù–ï –∏–∑–º–µ–Ω–µ–Ω–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
‚úÖ –ï—Å—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ—Ç–∫–∞—Ç–∞ (rollback plan)
‚úÖ Sentry –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
‚úÖ Changelog –æ–±–Ω–æ–≤–ª–µ–Ω
‚úÖ –ö–æ–º–∞–Ω–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∞ –æ deploy

‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ø–ª–æ–∏—Ç—å:
‚ùå –í –ø—è—Ç–Ω–∏—Ü—É –≤–µ—á–µ—Ä–æ–º
‚ùå –ü–µ—Ä–µ–¥ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏
‚ùå –ï—Å–ª–∏ staging –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
‚ùå –ë–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
‚ùå –ë–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–∏–º –∫–æ–º–º–∏—Ç–æ–º
```

---

## üìà –ú–ï–¢–†–ò–ö–ò –ö–ê–ß–ï–°–¢–í–ê DEPLOYMENT

### –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ deploy –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **Error Rate** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤ –º–∏–Ω—É—Ç—É
   - –î–æ deploy: baseline
   - –ü–æ—Å–ª–µ deploy: –Ω–µ –¥–æ–ª–∂–Ω–æ –≤—ã—Ä–∞—Å—Ç–∏ > 5%

2. **Response Time** - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
   - –î–æ deploy: baseline
   - –ü–æ—Å–ª–µ deploy: –Ω–µ –¥–æ–ª–∂–Ω–æ –≤—ã—Ä–∞—Å—Ç–∏ > 10%

3. **Success Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –î–æ deploy: ~99%
   - –ü–æ—Å–ª–µ deploy: –Ω–µ –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å < 98%

4. **User Experience** - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä–º—É –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∂–∞–ª–æ–±—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –µ—Å–ª–∏:

```javascript
// –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
const metrics = await getMetrics();

if (
  metrics.errorRate > baseline.errorRate * 1.5 || // –û—à–∏–±–æ–∫ –Ω–∞ 50% –±–æ–ª—å—à–µ
  metrics.responseTime > baseline.responseTime * 1.2 || // –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –Ω–∞ 20%
  metrics.successRate < 0.95 // –ú–µ–Ω—å—à–µ 95% —É—Å–ø–µ—Ö–∞
) {
  // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ö–ê–¢
  await rollbackDeployment();
  await notifyTeam('AUTOMATIC ROLLBACK TRIGGERED');
}
```

---

## üéâ –ò–¢–û–ì–û–í–ê–Ø TIMELINE

```
–ù–µ–¥–µ–ª—è 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
‚îú‚îÄ –î–µ–Ω—å 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (branches, staging, CI/CD)
‚îú‚îÄ –î–µ–Ω—å 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ì–æ—Ç–æ–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–ù–µ–¥–µ–ª—è 2: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—á–∞—Å—Ç—å 1)
‚îú‚îÄ –î–µ–Ω—å 3-6: XSS –∑–∞—â–∏—Ç–∞ (develop ‚Üí staging ‚Üí production)
‚îú‚îÄ –î–µ–Ω—å 7-8: CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –∏ CSRF

–ù–µ–¥–µ–ª—è 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—á–∞—Å—Ç—å 2)
‚îú‚îÄ –î–µ–Ω—å 9-11: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ –î–µ–Ω—å 12-14: JWT —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

–ù–µ–¥–µ–ª—è 4: JWT –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ
‚îú‚îÄ –î–µ–Ω—å 15-16: JWT –Ω–∞ staging
‚îú‚îÄ –î–µ–Ω—å 17-18: JWT –Ω–∞ production (—Å feature flag)
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ù–µ–¥–µ–ª—è 5: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤
‚îú‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω—ã

–î–∞–ª–µ–µ: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
‚îú‚îÄ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–ø–æ —Ç–æ–º—É –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—É)
‚îú‚îÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îî‚îÄ –ù–æ–≤—ã–µ —Ñ–∏—á–∏
```

---

## üõ°Ô∏è –ì–ê–†–ê–ù–¢–ò–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

–ü—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ —ç—Ç–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

‚úÖ **100% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å** —á—Ç–æ production –Ω–µ —Å–ª–æ–º–∞–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ
‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç** –∑–∞ 5 –º–∏–Ω—É—Ç –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º
‚úÖ **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º deploy
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

---

## üìû –í –°–õ–£–ß–ê–ï –ü–†–û–ë–õ–ï–ú

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. **–ù–ï –ü–ê–ù–ò–ö–£–ô–¢–ï** - —É –≤–∞—Å –µ—Å—Ç—å rollback –ø–ª–∞–Ω
2. –í—ã–∫–ª—é—á–∏—Ç–µ feature flag ‚Üí —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
3. –ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç–µ deploy: `vercel rollback`
4. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ staging
5. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:

- Sentry alerts ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- GitHub ‚Üí issues –¥–ª—è –±–∞–≥–æ–≤
- Team chat ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã

---

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: –î–≤–∏–≥–∞—Ç—å—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ = –ø—Ä–∏–π—Ç–∏ –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –ø–æ–ª–æ–º–æ–∫!** üéØ