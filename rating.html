<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤ - –ú–ê–§-–ö–ª—É–±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .rating-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
        }

        .rating-table th,
        .rating-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rating-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .rating-table tbody tr {
            transition: all 0.3s;
            cursor: pointer;
        }

        .rating-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .rank-cell {
            font-weight: bold;
            font-size: 1.2rem;
            color: #fbbf24;
            width: 60px;
            text-align: center;
        }

        .rank-1 { color: #ffd700; font-size: 1.5rem; }
        .rank-2 { color: #c0c0c0; font-size: 1.4rem; }
        .rank-3 { color: #cd7f32; font-size: 1.3rem; }

        .player-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .points-positive {
            color: #4ade80;
            font-weight: bold;
        }

        .points-negative {
            color: #f87171;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #f87171;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .rating-table {
                font-size: 0.9rem;
            }

            .rating-table th,
            .rating-table td {
                padding: 10px 5px;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h1>
            <p>MafClub.biz</p>
        </div>

        <div id="content">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>
        </div>

        <div style="text-align: center; margin-top: 30px; padding: 20px; opacity: 0.7; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <a href="day-stats.html" style="color: white; text-decoration: none; font-size: 0.9rem; padding: 8px 15px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
            </a>
            <a href="rating-rules.html" style="color: white; text-decoration: none; font-size: 0.9rem; padding: 8px 15px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                üìñ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥
            </a>
        </div>
    </div>

    <script>
        async function loadRating() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ API
                const response = await fetch('/api/rating');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();

                // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {success: true, players: [...]}
                if (data.success && data.players) {
                    displayRating(data.players);
                } else {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç API');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        ‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}
                    </div>
                `;
            }
        }

        function displayRating(rating) {
            if (!rating || rating.length === 0) {
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        üìä –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </div>
                `;
                return;
            }

            let html = `
                <table class="rating-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–ò–≥—Ä</th>
                            <th>–û—á–∫–∏</th>
                            <th>–°—Ä–µ–¥–Ω–µ–µ</th>
                            <th>–ü–æ–±–µ–¥</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–Ω–≥ –∫ –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É
            let rank = 1;
            rating.forEach((player, index) => {
                player.rank = rank;
                // –ï—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –∏–≥—Ä–æ–∫ –∏–º–µ–µ—Ç –¥—Ä—É–≥–∏–µ –æ—á–∫–∏, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–Ω–≥
                if (index < rating.length - 1 && rating[index + 1].total_points !== player.total_points) {
                    rank = index + 2;
                }
            });

            rating.forEach(player => {
                const rankClass = player.rank <= 3 ? `rank-${player.rank}` : '';
                const pointsClass = player.total_points > 0 ? 'points-positive' :
                                   player.total_points < 0 ? 'points-negative' : '';

                // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
                const avgPoints = player.games_played > 0
                    ? (player.total_points / player.games_played).toFixed(2)
                    : '0.00';

                html += `
                    <tr onclick="openPlayer(${player.id})">
                        <td class="rank-cell ${rankClass}">${player.rank}</td>
                        <td class="player-name">${player.name}</td>
                        <td>${player.games_played}</td>
                        <td class="${pointsClass}">${player.total_points > 0 ? '+' : ''}${player.total_points}</td>
                        <td>${avgPoints}</td>
                        <td>${player.wins}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            document.getElementById('content').innerHTML = html;
        }

        function openPlayer(playerId) {
            window.location.href = `player.html?id=${playerId}`;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadRating;
    </script>

    <a href="login.html" style="position: fixed; bottom: 10px; right: 10px; opacity: 0.5; font-size: 0.75rem; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 5px; text-decoration: none; color: white; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='0.5'">
        v1.2.0
    </a>
</body>
</html>
